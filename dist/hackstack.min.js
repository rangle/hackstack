"use strict";angular.module("hackstack.mock",["hackstack.utils"]).factory("mock",["$http","$q","utils",function(t,r,n){function e(e,o){function a(t){return R.find(v(t))(e)}function u(t,r){var n={status:200,statusText:"OK",data:r};return t?t:n}function i(){return{status:201,statusText:"Created",data:""}}function s(){var t=x(null,"get");return null!==t?r.reject(t):angular.copy(w)}function c(t){var e=x(t,"get");if(null!==e)return r.reject(e);var o=a(t);return void 0!==o?{status:200,statusText:"OK",data:angular.copy(o)}:(e=n.getErrorByCode(404),r.reject(e))}function d(t){var o=R.keys(t),a=R.map(R.pick(o))(e),u=R.findIndex(R.eqDeep(t))(a),i=e[u];if(u!==-1)return{status:200,statusText:"OK",data:angular.copy(i)};var s=n.getErrorByCode(404);return r.reject(s)}function f(t,n){var o=x(t,"post");return null!==o?r.reject(o):(n&&(t.id=n()),e.push(t),u(null,e),i())}function l(t,n){var o=x(n,"post");if(null!==o)return r.reject(o);var a=R.findIndex(v(t))(e);return a>-1?(e[a]=n,{status:200,statusText:"OK",data:""}):r.reject(y(404))}function p(){return j().then(function(){return r.when(s())})}function h(t){return j().then(function(){return r.when(c(t))})}function m(t){return j().then(function(){return r.when(d(t))})}function g(t,n){return j().then(function(){return r.when(l(t,n))})}function b(){return R.max(R.pluck("id",e))+1}function k(t,n){return j().then(function(){return r.when(f(t,n))})}function E(t,r){return r=r||b,t.id?g(t.id,t):k(t,r)}var w,v;o&&(n.setOptions(o),v=o.makeCompareFn),v=v||function(t){return function(r){return r.id===t}};var T=n.disableRandomErrors,x=n.produceError,y=n.getErrorByCode,j=n.waitForTime;if(Array.isArray(e))w=u(null,e);else{if(!e||!e.indexOf||e.indexOf(".json")===-1)throw new Error("mockData required to be an array or .json path");t.get(e).then(function(t){w=u(t)}).then(null,function(t){throw new Error(t)})}return{create:k,disableRandomErrors:T,forceError:n.forceError,get:h,getAll:p,query:m,save:E,update:g}}return e}]);var mockEndpoints={},loggingEnabled=!1;angular.module("hackstack.feedhenry",["hackstack.mock"]).factory("mockFH",["mock","$window","$log",function(t,r,n){function e(){loggingEnabled&&n.info.apply(null,arguments)}function o(t){var r;return r=200===t.status?t.data:t,{status:200,statusText:"OK",data:{status:"Ok",data:r}}}function a(t){if("GET"!==t.method&&"POST"!==t.method)throw new Error("Unsupported method or method wasn't provided");if(void 0===t.data)throw new Error("options.data not provided")}function u(t,r,n){var u,i;a(t),u=mockEndpoints[t.path],"POST"===t.method&&u.save(t.data),i=u.get(t.data).then(function(r){return e("Request: ",t,"\nResponse: ",r),r}),i.then(function(t){r(o(t).data)},function(t){r(o(t).data)})}var i=Object.create(r.$fh||null);return i.addMockEndpoint=function(r,n,e){if(0===n.length||!Array.isArray(n))throw new Error("Expected mockData to be a non-empty array");if(void 0!==mockEndpoints[r])throw new Error("Endpoint already defined: ".concat(r));e=e||{},e.makeCompareFn=e.makeCompareFn||function(t){return function(t){return!0}};var o=t(n,e);o.disableRandomErrors(!0),mockEndpoints[r]=o},i.cloud=function(t,n,e){return void 0===mockEndpoints[t.path]?r.$fh.cloud(t,n,e):u(t,n,e)},i.forceBackendError=function(t){var r=Object.create(i);return r.cloud=function(r,n,e){var o=mockEndpoints[r.path];return void 0!==o&&(a(r),o.forceError(t)),i.cloud.apply(i,arguments)},r},i.enableLogging=function(){loggingEnabled=!0},i.disableLogging=function(){loggingEnabled=!1},i.listEndpoints=function(){return R.keys(mockEndpoints)},r.hsUtils.mockFH={listEndpoints:i.listEndpoints,enableLogging:i.enableLogging,disableLogging:i.disableLogging},i}]),angular.module("hackstack.utils",[]).factory("utils",["$timeout","$window",function(t,r){function n(){return b}function e(t){return t||t===!1?void(g=t):g}function o(t){if("number"!=typeof t)throw new Error("Must provide an integer error code");var r=R.filter(function(r){return r.status===t},w);return!(0===r.length||r.length>1)&&u(r[0])}function a(t){if(null===t)m=null;else{if(o(t)===!1)throw new Error("Unsupported HTTP Code");m=t}}function u(t){return{status:t.status,statusText:t.statusText,data:t.statusText.concat(" -- generated by HackStack")}}function i(t,r){return Math.floor(Math.random()*(r-t))+t}function s(t){t=t||w;var r=R.reduce(function(t,r){return t+r.distribution},0,t);if(r>h)throw new Error("Sum of distributions is greater than defined max");var n=i(0,h),e=null,a=0;return null!==m?u(o(m)):(g===!1&&R.forEach(function(t){a+=t.distribution,n<=a&&null===e&&(e=u(t))},t),e)}function c(t,r){var n=null;return null==t?null:(R.forEach(function(r){r.fn(t)===!0&&(n=u(o(r.errorCode)))},R.filter(R.propEq("method",r.toLowerCase()),b)),n)}function d(t,r,n){var e=c(t,r);return null===e&&(e=s(n)),e}function f(t,r,n){var e=["get","post","all"],o=R.pluck("status")(w);if(!t||"function"!=typeof t)throw new Error("generateError function requires a function as its first parameter");if(!r||R.indexOf(r,o)===-1)throw new Error("error code must be one of: "+o.toString());if(n=n||"all",R.indexOf(n.toLowerCase(),e)===-1)throw new Error("method must be one of: "+e.toString());var a=0;return b.length>0&&(a=R.max(R.pluck("id",b))+1),b.push({id:a,fn:t,errorCode:r,method:n.toLowerCase()}),function(){var t=a,r=R.findIndex(R.propEq("id",t))(b);b.splice(r,1)}}function l(){var r;return r=null!==E.absoluteTime?E.absoluteTime:i(E.minTime,E.maxTime),t(function(){return!0},r)}function p(t){E=R.merge(E,t)}var h=100,m=null,g=!1,b=[],k={maxTime:2e3,minTime:0,absoluteTime:null},E=k,w=[{status:0,statusText:"",distribution:5},{status:400,statusText:"Bad request",distribution:1},{status:401,statusText:"Not authorized",distribution:3},{status:403,statusText:"Forbidden",distribution:3},{status:404,statusText:"Not found",distribution:6},{status:405,statusText:"Method not allowed",distribution:2},{status:406,statusText:"Not acceptable",distribution:2},{status:407,statusText:"Proxy Authentication Required",distribution:0},{status:408,statusText:"Request timeout",distribution:2},{status:409,statusText:"Conflict",distribution:1},{status:410,statusText:"Gone",distribution:1},{status:411,statusText:"Length required",distribution:1},{status:412,statusText:"Precondition Failed",distribution:1},{status:413,statusText:"Request entity too large",distribution:1},{status:414,statusText:"Request-URI too long",distribution:1},{status:415,statusText:"Unsupported media type",distribution:1},{status:416,statusText:"Requested range not satisfiable",distribution:1},{status:417,statusText:"Expectation failed",distribution:1},{status:500,statusText:"Internal server error",distribution:5},{status:501,statusText:"Not implemented",distribution:1},{status:502,statusText:"Bad gateway",distribution:0},{status:503,statusText:"Service unavailable",distribution:1},{status:504,statusText:"Gateway timeout",distribution:0},{status:505,statusText:"HTTP version not supported",distribution:0}];return r.hsUtils={forceError:a,disableRandomErrors:e},{addErrorTrigger:f,disableRandomErrors:e,forceError:a,getErrorByCode:o,produceError:d,randomError:s,randomInt:i,setOptions:p,waitForTime:l,_getErrorTriggers:n}}]),angular.module("hackstack.wrap",["hackstack.utils"]).factory("wrap",["$q","$http","utils",function(t,r,n){function e(e,o,a){function u(t,r){var n=angular.copy(r),e=angular.copy(t);for(var o in n)void 0===n[o]||"object"!=typeof n[o]||Array.isArray(n[o])?e[o]=n[o]:e[o]=u(e[o],n[o]);return e}function i(t,r){return a.priorityMock&&a.priorityMock===!0?u(t,r):u(r,t)}function s(){return r.get(m).then(function(t){var r=R.map(function(t){return i(t,o)},t.data);return t.data=r,t})}function c(t){return r.get([m,t].join("/")).then(function(t){return t.data=i(t.data,o),t})}function d(n,e){e&&(n=e(n));var o=b(n,"post");return null!==o?t.reject(o):r.post(m,n).then(function(t){var r;return t.headers("location")?(r=R.last(t.headers().location.split("/")),h(r)):t})}function f(n,e,o){o&&(e=o(e));var a=b(e,"post");return null!==a?t.reject(a):r.post([m,n].join("/"),e)}function l(t,r){return t.id?f(t.id,t,r):d(t,r)}function p(){var r=b();return null!==r?t.reject(r):k().then(function(){return t.when(s())})}function h(r){var n=b(r,"get");return null!==n?t.reject(n):k().then(function(){return t.when(c(r))})}if(void 0===e)throw new Error("wrapper must be provided with an endpoint");if(void 0===o)throw new Error("wrapper must be provided with mock data");if("object"!=typeof o)throw new Error("mock data must be an object");if(R.isArrayLike(o)===!0)throw new Error("mock data must be an object, not an array");a=a||{},a.priorityMock=a.priorityMock||!1,n.setOptions(a);var m=e,g=n.disableRandomErrors,b=n.produceError,k=n.waitForTime;return{create:d,disableRandomErrors:g,forceError:n.forceError,getAll:p,get:h,query:p,save:l,update:f}}return e}]),angular.module("hackstack",["hackstack.mock","hackstack.wrap","hackstack.utils","hackstack.feedhenry"]).factory("hackstack",["mock","wrap","utils",function(t,r,n){return{mock:t,wrap:r,utils:n}}]);